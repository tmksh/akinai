<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>連携ガイド — akinai Docs</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700;900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <style>
    /* ガイドレイアウト */
    .guide-layout {
      display: grid;
      grid-template-columns: 200px 1fr;
      gap: 2.5rem;
      max-width: 1080px;
      margin: 0 auto;
      padding: 2.5rem 2rem;
      align-items: start;
    }
    @media (max-width: 800px) {
      .guide-layout { grid-template-columns: 1fr; }
      .sidebar { position: static; }
    }
  </style>
</head>
<body>

<nav class="nav">
  <a href="index.html" class="nav-logo">akinai <span>Docs</span></a>
  <ul class="nav-links">
    <li><a href="index.html">はじめに</a></li>
    <li><a href="guide.html" class="active">連携ガイド</a></li>
    <li><a href="api.html">API一覧</a></li>
  </ul>
  <span class="nav-version">v1.0</span>
</nav>

<!-- Page Hero -->
<div class="page-hero">
  <div class="container">
    <span class="tag">連携ガイド</span>
    <h1>フロントエンドへの連携手順</h1>
    <p>APIキーの取得から商品表示・カート・決済まで、順番に進めるだけで完了します。</p>
  </div>
</div>

<div class="guide-layout">

  <!-- Sidebar -->
  <aside class="sidebar" style="position:sticky;top:72px;">
    <p class="sidebar-group-title">準備</p>
    <a href="#prereq">事前準備</a>
    <a href="#apikey">APIキーの取得</a>
    <p class="sidebar-group-title">実装</p>
    <a href="#products">商品を表示する</a>
    <a href="#cart">カートを作る</a>
    <a href="#checkout">決済する</a>
    <a href="#contents">コンテンツを表示する</a>
    <p class="sidebar-group-title">補足</p>
    <a href="#errors">エラーへの対処</a>
  </aside>

  <!-- Main -->
  <main class="guide-content">

    <!-- 事前準備 -->
    <h2 id="prereq">事前準備</h2>
    <p>連携を始める前に、以下の3つが揃っているか確認してください。</p>

    <div class="card-grid" style="margin-bottom:1.5rem;">
      <div class="card" style="padding:1.1rem;">
        <p class="card-label">必須</p>
        <h3 style="font-size:.9rem;">akinai アカウント</h3>
        <p style="font-size:.82rem;">管理画面にログインできる状態</p>
      </div>
      <div class="card" style="padding:1.1rem;">
        <p class="card-label">必須</p>
        <h3 style="font-size:.9rem;">フロントエンド環境</h3>
        <p style="font-size:.82rem;">Next.js / React / Vue など</p>
      </div>
      <div class="card" style="padding:1.1rem;">
        <p class="card-label">推奨</p>
        <h3 style="font-size:.9rem;">Node.js 18以上</h3>
        <p style="font-size:.82rem;">標準の fetch API が使えます</p>
      </div>
    </div>

    <!-- APIキーの取得 -->
    <h2 id="apikey">APIキーの取得</h2>
    <p>APIキーは akinai 管理画面から発行します。3ステップで完了します。</p>

    <div class="steps">

      <!-- Step 1 -->
      <div class="step">
        <div class="step-badge">1</div>
        <div class="step-body">
          <h3>管理画面にログインする</h3>
          <p>ブラウザで管理画面のURLを開き、メールアドレスとパスワードでログインします。</p>
          <div class="browser">
            <div class="browser-bar">
              <div class="browser-dots">
                <span style="background:#ef4444;"></span>
                <span style="background:#f59e0b;"></span>
                <span style="background:#10b981;"></span>
              </div>
              <div class="browser-url">https://yourshop.akinai.jp/login</div>
            </div>
            <div class="browser-body">
              <img src="screenshots/login.png" alt="ログイン画面" style="width:100%;display:block;" />
            </div>
          </div>
        </div>
      </div>

      <!-- Step 2 -->
      <div class="step">
        <div class="step-badge">2</div>
        <div class="step-body">
          <h3>設定からAPIキーのページへ移動する</h3>
          <p>左側のメニューから <strong>「設定」</strong> をクリックし、<strong>「外部連携」または「APIキー」</strong> タブを選択します。</p>

          <div class="callout callout-info">
            <div>
              <strong>管理画面スクリーンショットの追加方法</strong>
              <p>管理者アカウントでログインして <code>node scripts/take-admin-screenshots.mjs メール パスワード</code> を実行すると、実際の管理画面が自動で保存されます。</p>
            </div>
          </div>

          <div class="browser">
            <div class="browser-bar">
              <div class="browser-dots">
                <span style="background:#ef4444;"></span>
                <span style="background:#f59e0b;"></span>
                <span style="background:#10b981;"></span>
              </div>
              <div class="browser-url">https://yourshop.akinai.jp/settings</div>
            </div>
            <div class="browser-body">
              <img src="screenshots/admin-settings.png" alt="設定画面" style="width:100%;display:block;"
                onerror="this.style.display='none';this.nextElementSibling.style.display='flex';" />
              <div style="display:none;align-items:center;justify-content:center;padding:3rem;background:#fafaf9;flex-direction:column;gap:.75rem;">
                <svg width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="#a8a29e" stroke-width="1.5"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M3 9h18M9 21V9"/></svg>
                <p style="color:var(--text-muted);font-size:.85rem;">スクリーンショットがまだ追加されていません</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Step 3 -->
      <div class="step">
        <div class="step-badge">3</div>
        <div class="step-body">
          <h3>APIキーを発行して安全に保管する</h3>
          <p>「新しいキーを発行」ボタンを押すと、<code>ak_live_xxxxxxxx</code> という形式のキーが発行されます。<strong>このキーは一度しか表示されません。</strong>必ずコピーして保管してください。</p>

          <div class="callout callout-warn">
            <div>
              <strong>APIキーは絶対に公開しないでください</strong>
              <p>GitHubなどにアップロードしないよう、<code>.env.local</code> ファイルで管理し、<code>.gitignore</code> に追記してください。</p>
            </div>
          </div>

          <div style="background:white;border:1px solid var(--border);border-radius:var(--radius);padding:1.25rem;margin-top:1rem;">
            <p style="font-weight:700;font-size:.875rem;margin-bottom:.75rem;">プロジェクトの <code>.env.local</code> に追加する内容</p>
            <div style="background:#fafaf9;border:1px solid var(--border);border-radius:6px;padding:1rem;font-family:monospace;font-size:.82rem;color:var(--text);">
              <p style="color:var(--text-muted);"># akinai のURLとAPIキー</p>
              <p>NEXT_PUBLIC_AKINAI_BASE_URL=https://yourshop.akinai.jp</p>
              <p>AKINAI_API_KEY=ak_live_xxxxxxxxxxxxxxxx</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="divider"></div>

    <!-- 商品を表示する -->
    <h2 id="products">商品を表示する</h2>
    <p>APIキーが取得できたら、最初のステップとして商品一覧を取得してみましょう。</p>

    <h3>商品一覧API</h3>
    <p>
      <code>GET /api/v1/products</code> を呼び出すと、商品の一覧がJSON形式で返ってきます。<br>
      リクエスト時に <code>Authorization: Bearer &lt;APIキー&gt;</code> をヘッダに付けてください。
    </p>

    <div class="tbl-wrap" style="margin-bottom:1.25rem;">
      <table class="tbl">
        <thead>
          <tr><th>パラメータ</th><th>説明</th><th>例</th></tr>
        </thead>
        <tbody>
          <tr>
            <td class="ep">page</td>
            <td>ページ番号（省略時は1）</td>
            <td class="ep">1</td>
          </tr>
          <tr>
            <td class="ep">limit</td>
            <td>1ページの件数（最大100）</td>
            <td class="ep">12</td>
          </tr>
          <tr>
            <td class="ep">search</td>
            <td>商品名・説明のキーワード検索</td>
            <td class="ep">Tシャツ</td>
          </tr>
          <tr>
            <td class="ep">category_id</td>
            <td>カテゴリで絞り込み</td>
            <td class="ep">cat_123</td>
          </tr>
        </tbody>
      </table>
    </div>

    <p>以下は実際のショップフロントエンドで商品一覧が表示された画面です。</p>

    <div class="browser">
      <div class="browser-bar">
        <div class="browser-dots">
          <span style="background:#ef4444;"></span>
          <span style="background:#f59e0b;"></span>
          <span style="background:#10b981;"></span>
        </div>
        <div class="browser-url">https://yoursite.com/shop/products</div>
      </div>
      <div class="browser-body">
        <img src="screenshots/shop-products.png" alt="商品一覧ページ" style="width:100%;display:block;"
          onerror="this.style.display='none';this.nextElementSibling.style.display='flex';" />
        <div style="display:none;align-items:center;justify-content:center;padding:3rem;background:#fafaf9;flex-direction:column;gap:.75rem;">
          <svg width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="#a8a29e" stroke-width="1.5"><rect x="2" y="7" width="20" height="14" rx="2"/><path d="M16 7V5a2 2 0 0 0-4 0v2M8 7V5a2 2 0 0 0-4 0v2"/></svg>
          <p style="color:var(--text-muted);font-size:.85rem;">商品ページのスクリーンショット</p>
        </div>
      </div>
    </div>

    <div class="divider"></div>

    <!-- カートを作る -->
    <h2 id="cart">カートを作る</h2>
    <p>
      商品をカートに追加したあと、決済に進む前に <code>POST /api/v1/cart/validate</code> でカートの内容を確認します。<br>
      このAPIが在庫切れや価格変更を自動で検知してくれます。
    </p>

    <div class="tbl-wrap" style="margin-bottom:1.25rem;">
      <table class="tbl">
        <thead>
          <tr><th>送るデータ</th><th>説明</th><th>必須</th></tr>
        </thead>
        <tbody>
          <tr>
            <td class="ep">items[].product_id</td>
            <td>商品のID</td>
            <td><span class="badge" style="background:#fee2e2;color:#dc2626;font-size:.72rem;">必須</span></td>
          </tr>
          <tr>
            <td class="ep">items[].variant_id</td>
            <td>バリアントのID（サイズ・カラーなど）</td>
            <td><span class="badge badge-gray">任意</span></td>
          </tr>
          <tr>
            <td class="ep">items[].quantity</td>
            <td>購入数量</td>
            <td><span class="badge" style="background:#fee2e2;color:#dc2626;font-size:.72rem;">必須</span></td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="callout callout-ok">
      <div>
        <strong>返ってくるデータ</strong>
        <p>在庫OK・在庫なし・価格変更などの情報が含まれます。<code>valid: true</code> の場合のみ次の決済ステップに進んでください。</p>
      </div>
    </div>

    <div class="divider"></div>

    <!-- 決済する -->
    <h2 id="checkout">決済する</h2>
    <p>カート検証が通ったら、<code>POST /api/v1/checkout</code> で Stripe の決済ページへのURLを取得します。</p>

    <!-- 決済フロー -->
    <div class="step-flow" style="margin:1.25rem 0;">
      <div class="step-node">
        <div class="step-num">1</div>
        <p class="step-name">カート確認</p>
        <p class="step-desc">validate APIで<br>検証する</p>
      </div>
      <div class="step-arrow">&#8594;</div>
      <div class="step-node">
        <div class="step-num">2</div>
        <p class="step-name">住所入力</p>
        <p class="step-desc">配送先を<br>フォームで入力</p>
      </div>
      <div class="step-arrow">&#8594;</div>
      <div class="step-node">
        <div class="step-num">3</div>
        <p class="step-name">セッション作成</p>
        <p class="step-desc">checkout APIに<br>POSTする</p>
      </div>
      <div class="step-arrow">&#8594;</div>
      <div class="step-node">
        <div class="step-num">4</div>
        <p class="step-name">Stripeへ遷移</p>
        <p class="step-desc">返ってきた URL に<br>リダイレクト</p>
      </div>
      <div class="step-arrow">&#8594;</div>
      <div class="step-node">
        <div class="step-num">5</div>
        <p class="step-name">完了</p>
        <p class="step-desc">success_url に<br>戻ってくる</p>
      </div>
    </div>

    <div class="tbl-wrap" style="margin-bottom:1.25rem;">
      <table class="tbl">
        <thead>
          <tr><th>送るデータ</th><th>説明</th><th>必須</th></tr>
        </thead>
        <tbody>
          <tr>
            <td class="ep">items</td>
            <td>カートのアイテム一覧</td>
            <td><span class="badge" style="background:#fee2e2;color:#dc2626;font-size:.72rem;">必須</span></td>
          </tr>
          <tr>
            <td class="ep">customer_email</td>
            <td>購入者のメールアドレス</td>
            <td><span class="badge" style="background:#fee2e2;color:#dc2626;font-size:.72rem;">必須</span></td>
          </tr>
          <tr>
            <td class="ep">shipping_address</td>
            <td>配送先住所（氏名・郵便番号・都道府県・住所）</td>
            <td><span class="badge" style="background:#fee2e2;color:#dc2626;font-size:.72rem;">必須</span></td>
          </tr>
          <tr>
            <td class="ep">success_url</td>
            <td>決済成功後にリダイレクトするURL</td>
            <td><span class="badge" style="background:#fee2e2;color:#dc2626;font-size:.72rem;">必須</span></td>
          </tr>
          <tr>
            <td class="ep">cancel_url</td>
            <td>キャンセル時にリダイレクトするURL</td>
            <td><span class="badge" style="background:#fee2e2;color:#dc2626;font-size:.72rem;">必須</span></td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="callout callout-info">
      <div>
        <strong>Stripe の決済ページについて</strong>
        <p>APIから返ってくる <code>url</code> にユーザーをリダイレクトすると、Stripe が提供するクレジットカード入力ページが開きます。支払いが完了すると <code>success_url</code> に指定したページへ戻ります。</p>
      </div>
    </div>

    <div class="divider"></div>

    <!-- コンテンツを表示する -->
    <h2 id="contents">コンテンツを表示する</h2>
    <p>ニュースやブログ記事などは <code>GET /api/v1/contents</code> で取得できます。</p>

    <div class="tbl-wrap" style="margin-bottom:1.25rem;">
      <table class="tbl">
        <thead>
          <tr><th>パラメータ</th><th>説明</th></tr>
        </thead>
        <tbody>
          <tr>
            <td class="ep">type</td>
            <td>コンテンツの種類（例: <code>news</code>、<code>blog</code>）</td>
          </tr>
          <tr>
            <td class="ep">category</td>
            <td>カテゴリで絞り込む</td>
          </tr>
          <tr>
            <td class="ep">page / limit</td>
            <td>ページネーション</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="divider"></div>

    <!-- エラーへの対処 -->
    <h2 id="errors">エラーへの対処</h2>
    <p>APIがエラーを返したときは、HTTPステータスコードと <code>error</code> フィールドで原因を確認してください。</p>

    <div class="tbl-wrap">
      <table class="tbl">
        <thead>
          <tr><th>ステータス</th><th>意味</th><th>対処方法</th></tr>
        </thead>
        <tbody>
          <tr>
            <td><span class="badge badge-gray">400</span></td>
            <td>リクエストの内容が不正</td>
            <td>送っているデータのフォーマットを確認してください</td>
          </tr>
          <tr>
            <td><span class="badge" style="background:#fee2e2;color:#dc2626;">401</span></td>
            <td>APIキーが無効</td>
            <td>環境変数のAPIキーが正しいか確認してください</td>
          </tr>
          <tr>
            <td><span class="badge" style="background:#fee2e2;color:#dc2626;">403</span></td>
            <td>権限なし</td>
            <td>そのAPIキーではこの操作は許可されていません</td>
          </tr>
          <tr>
            <td><span class="badge badge-gray">404</span></td>
            <td>データが見つからない</td>
            <td>指定したIDが正しいか確認してください</td>
          </tr>
          <tr>
            <td><span class="badge" style="background:#fef3c7;color:#92400e;">429</span></td>
            <td>リクエスト制限に達した</td>
            <td>少し待ってから再度試してください</td>
          </tr>
          <tr>
            <td><span class="badge" style="background:#fee2e2;color:#dc2626;">500</span></td>
            <td>サーバー側のエラー</td>
            <td>しばらく待ってから再度試してください</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div style="text-align:center;margin-top:2.5rem;">
      <a href="api.html" class="btn btn-primary">API詳細を確認する</a>
    </div>

  </main>
</div>

<footer class="footer">
  <p>akinai Docs &mdash; EC SaaS フロントエンド連携ガイド</p>
  <p style="margin-top:.4rem;">
    <a href="index.html">はじめに</a> &nbsp;&middot;&nbsp;
    <a href="guide.html">連携ガイド</a> &nbsp;&middot;&nbsp;
    <a href="api.html">API一覧</a>
  </p>
</footer>

</body>
</html>
